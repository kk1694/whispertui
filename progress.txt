# WhisperTUI Progress & Learnings

This file captures learnings and notes across Ralph Loop iterations.
Each Claude instance should read this at the start and append notes at the end.

---

## Learnings

### 2026-01-17: Step 1a - Project Init & XDG Paths

- Bun's `bun init` creates a working TypeScript setup quickly
- XDG Base Directory spec is straightforward: environment variables override defaults
- Bun's test runner (`bun test`) works well, supports describe/test/expect patterns
- The `ensureDir` helper with `{ recursive: true }` handles nested directory creation

### 2026-01-17: Step 1b - Config Schema & Loader

- Zod 4.x has breaking changes from Zod 3.x - `.default({})` on object schemas with inner defaults no longer works the same way
- Solution: Use a PartialConfigSchema with all optional fields, then deep merge with defaults
- The `@iarna/toml` package works well for TOML parsing
- Deep merge is needed for partial config objects to properly overlay onto defaults
- Test isolation with XDG paths: Set `XDG_CONFIG_HOME` to a temp directory, but ensure path structure matches what `getConfigPath()` expects

---

## Current State

- Project status: Step 1b complete
- Last completed task: Step 1b - Config Schema & Loader
- Current blockers: None

---

## Notes for Next Iteration

- Next task: Step 2a - State Machine
- The state machine should be pure (no I/O) for easy testing
- States: idle, recording, transcribing
- Events: start, stop, transcription_complete, error
- Need to add event emitter for state change notifications
